/*
    TABLAS DEL SISTEMA
    DDL
*/
--ELIMINAMOS TABLAS
DROP TABLE PARTICIPACION;
DROP TABLE USUARIO;
DROP TABLE CAMPEONATO;
DROP TABLE EQUIPO;


CREATE TABLE EQUIPO(
    COD_EQUIPO NUMBER(5) PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL
);

INSERT INTO EQUIPO VALUES(1, 'LAS AGUILAS');
INSERT INTO EQUIPO(COD_EQUIPO, NOMBRE) VALUES (40, 'AVENGERS');

CREATE TABLE USUARIO(
    CODIGO NUMBER(5) PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL,
    COD_EQUIPO REFERENCES EQUIPO
);

INSERT INTO USUARIO VALUES(100, 'JUAN PEREZ', 1);
INSERT INTO USUARIO(CODIGO, NOMBRE) VALUES(200, 'CESAR PERALES');
INSERT INTO USUARIO VALUES(300, 'MARIA VALENCIA', 40);


CREATE TABLE CAMPEONATO(
    CODIGO NUMBER(5) PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL,
    FECHA_INICIO DATE,
    FECHA_FIN DATE
);

INSERT INTO CAMPEONATO VALUES(1, 'NACIONAL ARGENTINA', SYSDATE, SYSDATE + 6);
INSERT INTO CAMPEONATO VALUES(2, 'CAMPEONATO MUNDIAL', '01-JAN-20', '07-JAN-20');
INSERT INTO CAMPEONATO VALUES(3, 'ELIMINATORIAS EUROPA', TO_DATE('10/05/2008', 'DD/MM/YYYY'), TO_DATE('15/05/2008', 'DD/MM/YYYY'));
INSERT INTO CAMPEONATO VALUES(4, 'CAMPEONATO PERUANO', TO_DATE('01/02/2010', 'DD/MM/YYYY'), TO_DATE('07/02/2010', 'DD/MM/YYYY'));

--EJEMPLOS ALTER TABLE
/*
ALTER TABLE CAMPEONATO ADD FECHA_FIN DATE;
ALTER TABLE CAMPEONATO DROP COLUMN FECHA;
ALTER TABLE CAMPEONATO ADD FECHA_INICIO DATE;
ALTER TABLE CAMPEONATO RENAME COLUMN FECHA_INICIO TO FECHA_INI;
*/


CREATE TABLE PARTICIPACION(
    COD_USUARIO REFERENCES USUARIO,
    COD_CAMPEONATO REFERENCES CAMPEONATO,
    RESULTADO VARCHAR2(40),
    PRIMARY KEY(COD_USUARIO, COD_CAMPEONATO)
);

INSERT INTO PARTICIPACION VALUES(100, 1, 'GANADOR');
INSERT INTO PARTICIPACION VALUES(200, 1, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(200, 2, 'GANADOR');
INSERT INTO PARTICIPACION VALUES(300, 1, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(300, 2, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(100, 3, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(200, 3, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(300, 3, 'GANADOR');
INSERT INTO PARTICIPACION VALUES(100, 4, 'PARTICIPANTE');
INSERT INTO PARTICIPACION VALUES(200, 4, 'GANADOR');
INSERT INTO PARTICIPACION VALUES(300, 4, 'PARTICIPANTE');

CREATE TABLE CORREO_USUARIO(
    COD_USUARIO REFERENCES USUARIO,
    DIRECCION_CORREO VARCHAR2(80),
    PRIMARY KEY(COD_USUARIO, DIRECCION_CORREO)
);

INSERT INTO CORREO_USUARIO VALUES (100, 'JPEREZ@GMAIL.COM');
INSERT INTO CORREO_USUARIO VALUES (100, 'JPEREZ@YAHOO.ES');
INSERT INTO CORREO_USUARIO VALUES (200, 'CPERALES@HOTMAIL.COM');


--CONSULTAS
SELECT * FROM USUARIO;
SELECT * FROM CAMPEONATO;

SELECT * FROM CAMPEONATO
WHERE FECHA_FIN - FECHA_INICIO = 6;


--OBTENER NOMBRE USUARIO, EL NOMBRE DEL CAMPEONATO Y EL RESULTADO
SELECT  U.NOMBRE AS NOMBRE_USUARIO, C.NOMBRE AS NOMBRE_CAMPEONATO, P.RESULTADO
FROM PARTICIPACION P, USUARIO U, CAMPEONATO C
WHERE P.COD_USUARIO = U.CODIGO
AND P.COD_CAMPEONATO = C.CODIGO;

--OBTENER NOMBRE USUARIO, NOMBRE DEL EQUIPO, EL NOMBRE DEL CAMPEONATO Y EL RESULTADO
SELECT U.NOMBRE AS NOMBRE_USUARIO, E.NOMBRE AS NOMBRE_EQUIPO, C.NOMBRE AS NOMBRE_CAMPEONATO, P.RESULTADO
FROM PARTICIPACION P, USUARIO U, CAMPEONATO C, EQUIPO E
WHERE P.COD_USUARIO = U.CODIGO
AND P.COD_CAMPEONATO = C.CODIGO
AND U.COD_EQUIPO = E.COD_EQUIPO;

--CAMPEONATOS (NOMBRE DEL CAMPEONATO, FECHA INICIO) DONDE HAYAN PARTICIPADO JUGADORES DEL EQUIPO "AVENGERS".
SELECT U.NOMBRE, C.NOMBRE, C.FECHA_INICIO
FROM USUARIO U, CAMPEONATO C, PARTICIPACION P, EQUIPO E
WHERE E.COD_EQUIPO = U.COD_EQUIPO
AND U.CODIGO = P.COD_USUARIO
AND P.COD_CAMPEONATO = C.CODIGO
AND E.NOMBRE = 'AVENGERS';

--NOMBRE DE LOS CAMPEONATOS QUE INICIARON DESPUES DEL 01/01/2019
SELECT * FROM CAMPEONATO
WHERE FECHA_INICIO > TO_DATE('01/01/2019', 'DD/MM/YYYY');

--MUESTRE DATOS DE LOS CAMPEONATOS QUE INICIARON ANTES DEL 02/05/2015.
--CONSIDERE NOMBRE DE CAMPEONATO Y NOMBRE DE LOS PARTICIPANTES.
SELECT C.NOMBRE AS NOMBRE_CAMPEONATO, U.NOMBRE AS NOMBRE_PARTICIPANTE
FROM CAMPEONATO C, PARTICIPACION P, USUARIO U
WHERE C.CODIGO = P.COD_CAMPEONATO
AND P.COD_USUARIO = U.CODIGO
AND C.FECHA_INICIO < TO_DATE('02/05/2015', 'DD/MM/YYYY');


--El correo del usuario Cesar Perales esta incorrecto. La direccion es CPERALESF@HOTMAIL.COM
UPDATE CORREO_USUARIO
SET DIRECCION_CORREO = 'CPERALESF@HOTMAIL.COM'
WHERE COD_USUARIO = 200
AND DIRECCION_CORREO = 'CPERALES@HOTMAIL.COM';


--El usuario Juan Perez ya no utiliza su direccion JPEREZ@YAHOO.ES
DELETE FROM CORREO_USUARIO
WHERE COD_USUARIO = 100
AND DIRECCION_CORREO = 'JPEREZ@YAHOO.ES';

--USUARIOS QUE PERTENECEN A LOS EQUIPOS 1, 2, o 5
SELECT * FROM USUARIO WHERE COD_EQUIPO IN (1, 2, 5);

--USUARIOS QUE NO TIENEN EQUIPO ASOCIADO
SELECT * FROM USUARIO WHERE COD_EQUIPO IS NULL;

--USUARIOS QUE NO PERTENEZCAN AL EQUIPO DE CODIGO 40
SELECT * FROM USUARIO WHERE COD_EQUIPO <> 40;

--CAMPEONATOS QUE SE HAYAN INICIADO ENTRE EL 2/10/2005 Y EL 10/4/2021
SELECT * FROM CAMPEONATO
WHERE FECHA_INICIO BETWEEN TO_DATE('02/10/2005', 'DD/MM/YYYY') AND TO_DATE('10/04/2021', 'DD/MM/YYYY');

--USUARIOS CUYO NOMBRE EMPIECE CON J
SELECT * FROM USUARIO
WHERE NOMBRE LIKE 'J%';

--USUARIOS CUYA SEGUNDA LETRA DEL NOMBRE SEA E
SELECT * FROM USUARIO
WHERE NOMBRE LIKE '_E%';

--FUNCIONES DE CADENAS
SELECT LPAD(CODIGO, 8, '0'), UPPER(NOMBRE), LOWER(NOMBRE), INITCAP(NOMBRE), LENGTH(NOMBRE)
FROM USUARIO;

--FUNCIONES NUMERICAS

SELECT TRUNC((5 * 6 + 12) / 11, 2) FROM DUAL;
SELECT ROUND((10 + 11) / 2) FROM DUAL;
SELECT POWER(2, 3), SQRT(2) FROM DUAL;

--FUNCIONES DE FECHA
SELECT FECHA_INICIO, TRUNC(MONTHS_BETWEEN(SYSDATE, FECHA_INICIO)) FROM CAMPEONATO;

SELECT FECHA_INICIO, ADD_MONTHS(FECHA_INICIO, 12) FROM CAMPEONATO;

SELECT FECHA_INICIO, TO_CHAR(FECHA_INICIO, 'DD MONTH, YYYY') FROM CAMPEONATO;

SELECT FECHA_INICIO, TO_CHAR(FECHA_INICIO, 'YEAR') FROM CAMPEONATO;